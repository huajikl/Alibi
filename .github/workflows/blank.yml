name: Build unsigned app # å°†åç§°æ”¹ä¸ºè¡¨ç¤ºæ„å»ºæœªç­¾ååº”ç”¨
on:
  release:
    types: [published] # æ‚¨ä¹Ÿå¯ä»¥è€ƒè™‘ä¿®æ”¹è§¦å‘å™¨ï¼Œä¾‹å¦‚åœ¨æ¯æ¬¡æ¨é€æˆ–PRæ—¶è¿è¡Œï¼Œä»¥ä¾¿äºæµ‹è¯•æœªç­¾åAPK

jobs:
  build-unsigned-apk: # ä¿®æ”¹ä½œä¸šåç§°
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - uses: gradle/wrapper-validation-action@v2

      # --- ç§»é™¤ KeyStore ç›¸å…³çš„æ­¥éª¤ ---
      # è¿™ä¸€æ­¥å¯ä»¥å®Œå…¨åˆ é™¤ï¼Œå› ä¸ºä¸å†éœ€è¦ç­¾å
      # - name: Write KeyStore ğŸ—ï¸
      #   uses: ./.github/actions/prepare-keystore
      #   with:
      #     signingStorePassword: ${{ secrets.SIGNING_STORE_PASSWORD }}
      #     signingKeyPassword: ${{ secrets.SIGNING_KEY_PASSWORD }}
      #     signingKeyAlias: ${{ secrets.SIGNING_KEY_ALIAS }}
      #     keyStoreBase64: ${{ secrets.KEYSTORE }}

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'adopt'
          java-version: 21
          cache: 'gradle'

      - name: Build Unsigned APKs ğŸ“± # ä¿®æ”¹æ­¥éª¤åç§°ä»¥åæ˜ æœªç­¾å
        # ä½¿ç”¨ 'assembleDebug' æˆ– 'assemble' æ¥æ„å»ºæœªç­¾åçš„ APK
        # assembleDebug ä¼šç”Ÿæˆä¸€ä¸ªè°ƒè¯•ç‰ˆæœ¬çš„ APKï¼Œé€šå¸¸æ˜¯æœªç­¾åçš„
        # assemble ä¼šæ„å»ºæ‰€æœ‰å˜ä½“çš„ APKï¼ŒåŒ…æ‹¬æœªç­¾åçš„è°ƒè¯•ç‰ˆæœ¬
        run: ./gradlew assembleDebug

      - name: Upload Unsigned APKs ğŸš€ # ä¿®æ”¹æ­¥éª¤åç§°
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/') # æ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹æ­¤æ¡ä»¶ï¼Œä¾‹å¦‚åœ¨æ¯æ¬¡æ„å»ºåéƒ½ä¸Šä¼ 
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
        with:
          # ä¿®æ”¹æ–‡ä»¶è·¯å¾„ä»¥åŒ¹é… assembleDebug çš„è¾“å‡º
          files: app/build/outputs/apk/debug/*.apk

      # --- ç§»é™¤ AABs æ„å»ºå’Œä¸Šä¼ æ­¥éª¤ï¼Œé™¤éæ‚¨ä¹Ÿéœ€è¦æœªç­¾åçš„ AAB ---
      # AAB é€šå¸¸ç”¨äºä¸Šä¼ åˆ° Google Playï¼Œéœ€è¦ç­¾åã€‚
      # å¦‚æœæ‚¨ä»ç„¶éœ€è¦æœªç­¾åçš„ AABï¼Œå¯ä»¥ç±»ä¼¼åœ°ä¿®æ”¹ï¼š
      # - name: Build Unsigned AABs ğŸ“±
      #   run: ./gradlew bundleDebug # é€šå¸¸ bundleDebug ä¼šç”Ÿæˆæœªç­¾åçš„ AAB
      # - name: Upload Unsigned AABs ğŸš€
      #   uses: softprops/action-gh-release@v1
      #   if: startsWith(github.ref, 'refs/tags/')
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
      #   with:
      #     files: app/build/outputs/bundle/debug/*.aab
